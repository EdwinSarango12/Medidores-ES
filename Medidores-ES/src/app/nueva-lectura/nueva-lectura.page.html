<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-title>
      <ion-icon name="add-circle" class="ion-margin-end"></ion-icon>
      Nueva Lectura
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="water" color="primary"></ion-icon>
        Registrar Lectura de Medidor
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <!-- Valor del Medidor -->
      <ion-item lines="full">
        <ion-icon name="speedometer" slot="start" color="primary"></ion-icon>
        <ion-label position="stacked">Valor del Medidor *</ion-label>
        <ion-input
          type="number"
          [(ngModel)]="valorMedidor"
          placeholder="Ingrese el valor"
          required
        ></ion-input>
      </ion-item>

      <!-- Observaciones -->
      <ion-item lines="full">
        <ion-icon name="document-text" slot="start" color="primary"></ion-icon>
        <ion-label position="stacked">Observaciones</ion-label>
        <ion-textarea
          [(ngModel)]="observaciones"
          placeholder="Ingrese observaciones adicionales"
          rows="3"
        ></ion-textarea>
      </ion-item>

      <!-- Foto del Medidor -->
      <ion-item>
        <ion-label>Foto del Medidor *</ion-label>
      </ion-item>
      <div class="photo-container">
        <ion-button
          expand="block"
          fill="outline"
          (click)="tomarFoto('medidor')"
          class="ion-margin-bottom"
        >
          <ion-icon name="camera" slot="start"></ion-icon>
          Tomar Foto del Medidor
        </ion-button>
        <div *ngIf="fotoMedidor" class="photo-preview">
          <img [src]="fotoMedidor" alt="Foto del medidor" />
          <ion-button
            fill="clear"
            color="danger"
            (click)="eliminarFoto('medidor')"
            size="small"
          >
            <ion-icon name="trash"></ion-icon>
          </ion-button>
        </div>
      </div>

      <!-- Foto de la Fachada -->
      <ion-item>
        <ion-label>Foto de la Fachada *</ion-label>
      </ion-item>
      <div class="photo-container">
        <ion-button
          expand="block"
          fill="outline"
          (click)="tomarFoto('fachada')"
          class="ion-margin-bottom"
        >
          <ion-icon name="camera" slot="start"></ion-icon>
          Tomar Foto de la Fachada
        </ion-button>
        <div *ngIf="fotoFachada" class="photo-preview">
          <img [src]="fotoFachada" alt="Foto de la fachada" />
          <ion-button
            fill="clear"
            color="danger"
            (click)="eliminarFoto('fachada')"
            size="small"
          >
            <ion-icon name="trash"></ion-icon>
          </ion-button>
        </div>
      </div>

      <!-- Ubicación GPS -->
      <ion-item>
        <ion-icon name="location" slot="start" color="primary"></ion-icon>
        <ion-label>Ubicación GPS</ion-label>
        <ion-icon
          [name]="ubicacionObtenida ? 'checkmark-circle' : 'location-outline'"
          [color]="ubicacionObtenida ? 'success' : 'medium'"
          slot="end"
        ></ion-icon>
      </ion-item>
      <div *ngIf="ubicacionObtenida && latitud && longitud" class="location-info">
        <p><strong>Latitud:</strong> {{ latitud | number:'1.6-6' }}</p>
        <p><strong>Longitud:</strong> {{ longitud | number:'1.6-6' }}</p>
        <div class="location-buttons">
          <ion-button
            fill="outline"
            size="small"
            (click)="obtenerUbicacion()"
          >
            <ion-icon name="refresh" slot="start"></ion-icon>
            Actualizar
          </ion-button>
          <ion-button
            fill="outline"
            size="small"
            (click)="ingresarUbicacionManual()"
          >
            <ion-icon name="create" slot="start"></ion-icon>
            Manual
          </ion-button>
        </div>
      </div>
      <div *ngIf="!ubicacionObtenida" class="location-warning">
        <ion-text color="warning">
          <p>Obteniendo ubicación...</p>
        </ion-text>
        <ion-button
          expand="block"
          fill="outline"
          (click)="ingresarUbicacionManual()"
          class="ion-margin-top"
        >
          <ion-icon name="location" slot="start"></ion-icon>
          Ingresar Ubicación Manualmente
        </ion-button>
      </div>

      <!-- Botón Guardar -->
      <ion-button
        expand="block"
        (click)="guardarLectura()"
        class="ion-margin-top"
        [disabled]="!ubicacionObtenida"
        color="primary"
      >
        <ion-icon name="save" slot="start"></ion-icon>
        Guardar Lectura
      </ion-button>
    </ion-card-content>
  </ion-card>
</ion-content>
